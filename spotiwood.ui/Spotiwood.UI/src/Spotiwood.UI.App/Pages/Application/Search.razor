@using Spotiwood.Framework.Api.Application;
@using Spotiwood.Framework.Api.Application.Abstractions;
@using Spotiwood.Framework.Api.Infrastructure;
@using Spotiwood.Framework.Messaging;
@using Spotiwood.UI.Components.Buttons
@using Spotiwood.UI.Components.Search
@using Spotiwood.UI.Components.TextFields
@using System.Text.Json;
@page "/search"
@inject IService _service
@inject IMessageBus _bus

<h3>Search</h3>

<SearchBar OnClick=OnSearchAsync PlaceHolder="Your favourite movies/series" Text="Search" @ref=_searchBar />

@code {
    private SearchBar? _searchBar;

    private async Task OnSearchAsync(MouseEventArgs e)
    {
        var query = _searchBar?.Query;
        var result = await _service.SearchAsync(query);
        _bus.Publish(result);
    }
}
