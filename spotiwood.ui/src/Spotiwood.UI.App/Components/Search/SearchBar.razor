@using Spotiwood.Framework.Api.Application.Abstractions;
@using Spotiwood.Framework.Messaging;
@using Spotiwood.UI.App.Events;
@inject IService _service
@inject IMessageBus _bus

<input type="search" placeholder=@PlaceHolder class=@ClassField @bind-value=@Query />
<button class=@ClassButton @onclick=OnSearch>
    @Text
</button>

@code {
    private string? Query { get; set; }

    [Parameter] public string? PlaceHolder { get; init; }
    [Parameter] public string? ClassButton { get; init; }
    [Parameter] public string? ClassField { get; init; }
    [Parameter] public string? Text { get; init; }

    private async void OnSearch(MouseEventArgs e)
    {
        var results = await _service.SearchAsync(Query);
        var @event = new SearchResultsChangedEvent() { Results = results };
        _bus.Publish(@event);
    }
}
